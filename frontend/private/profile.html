<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - NebulaCore</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="shortcut icon" type="image/png" href="/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/transitions.css">
  <link rel="stylesheet" href="/css/private-theme.css">
  <link rel="stylesheet" href="/css/private.css">
  <link rel="stylesheet" href="/css/os-shell.css">
  <style>
    .admin-users-section {
      margin-top: 20px;
      padding: 20px;
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--accent);
    }
    .admin-users-section h3 {
      margin: 0 0 15px;
      color: var(--primary);
      font-size: 16px;
    }
    .user-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
    }
    .user-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg);
      border-radius: 8px;
      border: 1px solid var(--accent);
    }
    .user-item img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }
    .user-item .info { flex: 1; }
    .user-item .name {
      font-weight: 600;
      color: var(--text);
      margin-bottom: 2px;
    }
    .user-item .meta {
      font-size: 11px;
      color: var(--text-light);
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 600;
      margin-left: 6px;
    }
    .badge-admin { background: var(--primary); color: white; }
    .badge-online { background: #2ecc71; color: white; }
    .badge-offline { background: #95a5a6; color: white; }
    .badge-banned { background: #e74c3c; color: white; }
    .badge-warn { background: #f39c12; color: white; }
    .user-count {
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 10px;
    }
  </style>
  <script src="/js/security.js"></script>
</head>
<body class="profile-page">
  <script>document.body.classList.add('layout-' + (localStorage.getItem('layoutMode') || 'classic'));</script>
  <div class="app-container">
    <nav class="navbar">
      <div class="nav-left">
        <h1>Profile</h1>
      </div>
      <div class="nav-right">
        <a href="/private/dashboard.html" class="logout-btn">← Dashboard</a>
      </div>
    </nav>

    <main class="profile-page">
      <div class="profile-card">
        <div class="profile-header">
          <img id="profilePic" src="" alt="Profile" class="profile-pic">
          <div class="profile-info">
            <h2 id="profileName">User</h2>
            <p id="profileStatus">Online</p>
          </div>
        </div>

        <div class="profile-section">
          <h3>Profile Picture</h3>
          <input type="file" id="avatarInput" accept=".png,.jpg,.jpeg,.gif">
          <button id="uploadBtn" class="btn-primary">Upload Avatar</button>
          <button id="removeBtn" class="btn-secondary">Remove Avatar</button>
        </div>

        <div class="profile-section">
          <h3>Account Info</h3>
          <div class="info-row">
            <label>Username:</label>
            <span id="usernameInfo">-</span>
          </div>
          <div class="info-row">
            <label>Member Since:</label>
            <span id="joinedInfo">-</span>
          </div>
        </div>

        <div class="profile-section">
          <h3>Change Username</h3>
          <input type="text" id="newUsernameInput" placeholder="Enter new username (3-20 characters)" maxlength="20">
          <button id="changeUsernameBtn" class="btn-primary">Update Username</button>
          <p id="usernameMessage" style="margin-top: 10px; font-size: 13px; display: none;"></p>
        </div>

        <div class="profile-section">
          <h3>Theme Preference</h3>
          <select id="themeSelector" class="theme-selector">
            <option value="ocean">Deep Ocean</option>
            <option value="arcade">Neon Arcade</option>
            <option value="candy">Cotton Candy</option>
            <option value="eclipse">Solar Eclipse</option>
            <option value="matrix">Cyber Matrix</option>
            <option value="notebook">School Notebook</option>
            <option value="gaming">Midnight Gaming</option>
            <option value="pixel">Retro Pixel</option>
            <option value="cloudy">Cloudy Day</option>
            <option value="academia">Royal Academia</option>
          </select>
        </div>

        <div class="profile-section">
          <h3>Profile Banner</h3>
          <div id="bannerPreview" style="width: 100%; height: 120px; background: linear-gradient(135deg, var(--primary), var(--secondary, #ff6b6b)); border-radius: 12px; margin-bottom: 12px; background-size: cover; background-position: center;"></div>
          <input type="file" id="bannerInput" accept=".png,.jpg,.jpeg,.gif,.webp" style="margin-bottom: 12px;">
          <div style="display: flex; gap: 10px;">
            <button id="uploadBannerBtn" class="btn-primary">Upload Banner</button>
            <button id="removeBannerBtn" class="btn-secondary">Remove</button>
          </div>
        </div>

        <div class="profile-section">
          <h3>Custom Wallpaper</h3>
          <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">Set a custom background for your dashboard</p>
          <input type="file" id="wallpaperInput" accept=".png,.jpg,.jpeg,.gif,.webp" style="margin-bottom: 12px;">
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button id="uploadWallpaperBtn" class="btn-primary">Upload Wallpaper</button>
            <button id="removeWallpaperBtn" class="btn-secondary">Remove</button>
          </div>
          <p id="wallpaperStatus" style="margin-top: 10px; font-size: 13px; display: none;"></p>
        </div>

        <div class="profile-section">
          <h3>Google Slides Presentation</h3>
          <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">View the embedded presentation below</p>
          <div style="position: relative; width: 100%; padding-bottom: 60%; border-radius: 12px; overflow: hidden; background: var(--bg);">
            <iframe 
              src="https://docs.google.com/document/d/1lkOFIi2Dv_fsQayAbvd87dKXL-MyPUBJt6BWs7f7K_4/preview" 
              style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; border-radius: 12px;"
              allowfullscreen>
            </iframe>
          </div>
          <a href="https://docs.google.com/document/d/1lkOFIi2Dv_fsQayAbvd87dKXL-MyPUBJt6BWs7f7K_4/edit?usp=sharing" 
             target="_blank" 
             style="display: inline-block; margin-top: 12px; color: var(--primary); text-decoration: none; font-size: 13px;">
            Open in Google Docs →
          </a>
        </div>

        <div class="profile-section" style="border-top: 2px solid #e74c3c; padding-top: 20px; margin-top: 20px;">
          <h3 style="color: #e74c3c;">Danger Zone</h3>
          <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 15px;">
            Once you delete your account, there is no going back. All your data, messages, and progress will be permanently removed.
          </p>
          <button id="deleteAccountBtn" class="btn-danger" style="background: #e74c3c; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
            Delete My Account
          </button>
        </div>
      </div>

      <!-- Admin Only: All Users Section -->
      <div class="admin-users-section" id="adminUsersSection" style="display: none;">
        <h3>All Registered Users (Admin Only)</h3>
        <p class="user-count" id="userCount">Loading...</p>
        <div class="user-list" id="allUsersList"></div>
      </div>
    </main>
  </div>

  <script src="/js/themes.js"></script>
  <script src="/js/transitions.js"></script>
  <script src="/js/stealth-mode.js"></script>
  <script src="/js/quick-switcher.js"></script>
  <script src="/js/auto-theme.js"></script>
  <script>
    function checkAuth() {
      const token = localStorage.getItem('authToken');
      const userStr = localStorage.getItem('user');
      
      if (!token || !userStr) {
        window.location.href = '/private/auth.html';
        return null;
      }
      
      try {
        return JSON.parse(userStr);
      } catch {
        window.location.href = '/private/auth.html';
        return null;
      }
    }

    function getAuthToken() {
      return localStorage.getItem('authToken');
    }

    function getCurrentUser() {
      const user = localStorage.getItem('user');
      return user ? JSON.parse(user) : null;
    }
  </script>
  <script src="/js/profile.js"></script>
  <script src="/js/os-shell.js"></script>
</body>
</html>
