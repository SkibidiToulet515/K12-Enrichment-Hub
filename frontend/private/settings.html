<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - NebulaCore</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="shortcut icon" type="image/png" href="/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/transitions.css">
  <link rel="stylesheet" href="/css/private-theme.css">
  <link rel="stylesheet" href="/css/private.css">
  <link rel="stylesheet" href="/css/os-shell.css">
  <script src="/js/private-auth.js"></script>
  <style>
    .settings-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 30px;
    }
    
    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .settings-header h1 {
      font-size: 2rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .back-btn {
      padding: 10px 20px;
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s;
    }
    
    .back-btn:hover {
      background: var(--primary);
      color: var(--bg);
    }
    
    .settings-section {
      background: var(--card);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .settings-section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .settings-section-title span {
      font-size: 24px;
    }
    
    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .setting-item:last-child {
      border-bottom: none;
    }
    
    .setting-info h4 {
      font-size: 15px;
      font-weight: 500;
      color: var(--text);
      margin: 0 0 4px;
    }
    
    .setting-info p {
      font-size: 13px;
      color: var(--text-secondary);
      margin: 0;
    }
    
    .setting-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg);
      border: 2px solid var(--glass-border);
      border-radius: 26px;
      transition: 0.3s;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 2px;
      bottom: 2px;
      background: var(--text);
      border-radius: 50%;
      transition: 0.3s;
    }
    
    .toggle-switch input:checked + .toggle-slider {
      background: var(--primary);
      border-color: var(--primary);
    }
    
    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(24px);
      background: white;
    }
    
    .layout-preview-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 15px;
    }
    
    .layout-preview {
      border: 3px solid var(--glass-border);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
      background: var(--bg);
    }
    
    .layout-preview:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }
    
    .layout-preview.active {
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(var(--primary-rgb, 76, 201, 240), 0.3);
    }
    
    .layout-preview-image {
      width: 100%;
      height: 150px;
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    .layout-preview-classic {
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: 10px;
    }
    
    .layout-preview-classic .preview-nav {
      height: 20px;
      background: var(--accent);
      border-radius: 4px;
      margin-bottom: 8px;
    }
    
    .layout-preview-classic .preview-content {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }
    
    .layout-preview-classic .preview-card {
      background: var(--card);
      border-radius: 4px;
    }
    
    .layout-preview-os {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .layout-preview-os .preview-desktop {
      flex: 1;
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }
    
    .layout-preview-os .preview-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .layout-preview-os .preview-icon-box {
      width: 24px;
      height: 24px;
      background: var(--card);
      border-radius: 6px;
    }
    
    .layout-preview-os .preview-icon-label {
      width: 20px;
      height: 4px;
      background: var(--text-secondary);
      border-radius: 2px;
    }
    
    .layout-preview-os .preview-window {
      position: absolute;
      top: 20px;
      left: 30px;
      right: 20px;
      bottom: 30px;
      background: var(--card);
      border-radius: 6px;
      border: 1px solid var(--glass-border);
      overflow: hidden;
    }
    
    .layout-preview-os .preview-window-header {
      height: 12px;
      background: var(--accent);
      display: flex;
      align-items: center;
      padding: 0 6px;
      gap: 3px;
    }
    
    .layout-preview-os .preview-window-btn {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    
    .layout-preview-os .preview-window-btn.red { background: #ff5f57; }
    .layout-preview-os .preview-window-btn.yellow { background: #ffbd2e; }
    .layout-preview-os .preview-window-btn.green { background: #28c940; }
    
    .layout-preview-os .preview-taskbar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 16px;
      background: rgba(20, 20, 30, 0.95);
      display: flex;
      align-items: center;
      padding: 0 6px;
      gap: 4px;
    }
    
    .layout-preview-os .preview-taskbar-btn {
      width: 12px;
      height: 12px;
      background: var(--primary);
      border-radius: 3px;
    }
    
    .layout-preview-os .preview-taskbar-app {
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    .layout-preview-label {
      padding: 12px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
      background: var(--card);
    }
    
    .layout-preview.active .layout-preview-label {
      color: var(--primary);
    }
    
    select.setting-select {
      padding: 10px 15px;
      background: var(--bg);
      border: 2px solid var(--glass-border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      min-width: 150px;
    }
    
    select.setting-select:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .setting-btn {
      padding: 10px 20px;
      background: var(--primary);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .setting-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(var(--primary-rgb, 76, 201, 240), 0.3);
    }
    
    .setting-btn.danger {
      background: #ff4444;
    }
    
    .setting-btn.danger:hover {
      box-shadow: 0 5px 15px rgba(255, 68, 68, 0.3);
    }
    
    .font-size-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .font-size-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: 2px solid var(--glass-border);
      background: var(--bg);
      color: var(--text);
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .font-size-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }
    
    .font-size-value {
      font-size: 14px;
      font-weight: 600;
      min-width: 40px;
      text-align: center;
    }
  </style>

</head>
<body>
  <script>document.body.classList.add('layout-' + (localStorage.getItem('layoutMode') || 'classic'));</script>
  <div class="settings-container">
    <div class="settings-header">
      <h1>‚öôÔ∏è Settings</h1>
      <a href="/private/dashboard.html" class="back-btn">‚Üê Dashboard</a>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üñ•Ô∏è</span> Layout Mode
      </div>
      <p style="color: var(--text-secondary); margin-bottom: 20px;">
        Choose between the classic web layout or the new OS-style desktop interface.
      </p>
      <div class="layout-preview-grid">
        <div class="layout-preview" id="layoutClassic" onclick="setLayoutMode('classic')">
          <div class="layout-preview-image">
            <div class="layout-preview-classic">
              <div class="preview-nav"></div>
              <div class="preview-content">
                <div class="preview-card"></div>
                <div class="preview-card"></div>
                <div class="preview-card"></div>
                <div class="preview-card"></div>
                <div class="preview-card"></div>
                <div class="preview-card"></div>
              </div>
            </div>
          </div>
          <div class="layout-preview-label">Classic Layout</div>
        </div>
        <div class="layout-preview" id="layoutOS" onclick="setLayoutMode('os')">
          <div class="layout-preview-image">
            <div class="layout-preview-os">
              <div class="preview-desktop">
                <div class="preview-icon"><div class="preview-icon-box"></div><div class="preview-icon-label"></div></div>
                <div class="preview-icon"><div class="preview-icon-box"></div><div class="preview-icon-label"></div></div>
                <div class="preview-icon"><div class="preview-icon-box"></div><div class="preview-icon-label"></div></div>
                <div class="preview-icon"><div class="preview-icon-box"></div><div class="preview-icon-label"></div></div>
              </div>
              <div class="preview-window">
                <div class="preview-window-header">
                  <div class="preview-window-btn red"></div>
                  <div class="preview-window-btn yellow"></div>
                  <div class="preview-window-btn green"></div>
                </div>
              </div>
              <div class="preview-taskbar">
                <div class="preview-taskbar-btn"></div>
                <div class="preview-taskbar-app"></div>
                <div class="preview-taskbar-app"></div>
                <div class="preview-taskbar-app"></div>
              </div>
            </div>
          </div>
          <div class="layout-preview-label">OS Layout</div>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üé®</span> Appearance
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Theme</h4>
          <p>Choose your visual theme</p>
        </div>
        <div class="setting-control">
          <a href="/private/themes.html" class="setting-btn">Open Theme Selector</a>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Custom Theme Creator</h4>
          <p>Create and share your own themes</p>
        </div>
        <div class="setting-control">
          <a href="/private/theme-creator.html" class="setting-btn">Open Theme Creator</a>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Font Family</h4>
          <p>Change the global font</p>
        </div>
        <div class="setting-control">
          <select class="setting-select" id="fontSelect" onchange="setFont(this.value)">
            <option value="Inter">Inter (Default)</option>
            <option value="Roboto">Roboto</option>
            <option value="Open Sans">Open Sans</option>
            <option value="Poppins">Poppins</option>
            <option value="Montserrat">Montserrat</option>
            <option value="Source Code Pro">Source Code Pro</option>
            <option value="JetBrains Mono">JetBrains Mono</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>‚ôø</span> Accessibility
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Font Size</h4>
          <p>Adjust the base font size</p>
        </div>
        <div class="setting-control">
          <div class="font-size-control">
            <button class="font-size-btn" onclick="adjustFontSize(-1)">‚àí</button>
            <span class="font-size-value" id="fontSizeValue">100%</span>
            <button class="font-size-btn" onclick="adjustFontSize(1)">+</button>
          </div>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Reduce Motion</h4>
          <p>Minimize animations and transitions</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="reduceMotionToggle" onchange="toggleReduceMotion(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>High Contrast</h4>
          <p>Increase color contrast for better visibility</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="highContrastToggle" onchange="toggleHighContrast(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üîî</span> Notifications
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Enable Notifications</h4>
          <p>Show notification popups</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="notificationsToggle" checked onchange="toggleNotifications(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Sound Effects</h4>
          <p>Play sounds for notifications and actions</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="soundsToggle" checked onchange="toggleSounds(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Chat Message Notifications</h4>
          <p>Show notifications for new chat messages</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="chatNotifToggle" checked onchange="toggleChatNotifications(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Muted Servers</h4>
          <p>Servers you won't receive notifications from</p>
        </div>
        <div class="setting-control">
          <button class="setting-btn" onclick="openMuteManager('servers')">Manage</button>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Muted Users</h4>
          <p>Users you won't receive notifications from</p>
        </div>
        <div class="setting-control">
          <button class="setting-btn" onclick="openMuteManager('users')">Manage</button>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üõ°Ô∏è</span> Stealth Mode & Cloaking
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Panic Button</h4>
          <p>Press ` (backtick) or ESC twice to activate</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="panicButtonToggle" checked onchange="togglePanicButton(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Panic Destination</h4>
          <p>Where to redirect when panic is triggered</p>
        </div>
        <div class="setting-control">
          <select class="setting-select" id="panicTargetSelect" onchange="setPanicTarget(this.value)">
            <option value="ClassLink Launchpad">ClassLink Launchpad</option>
            <option value="Staff Portal Login">Staff Portal Login</option>
          </select>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Tab Disguise</h4>
          <p>Change tab title and icon to look like another site</p>
        </div>
        <div class="setting-control">
          <select class="setting-select" id="tabDisguiseSelect" onchange="setTabDisguise(this.value)">
            <option value="None">None (NebulaCore)</option>
            <option value="Google Docs">Google Docs</option>
            <option value="Google Classroom">Google Classroom</option>
            <option value="Khan Academy">Khan Academy</option>
            <option value="Google Drive">Google Drive</option>
          </select>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Show Panic Button</h4>
          <p>Display the floating panic button on screen</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="showPanicBtnToggle" checked onchange="toggleShowPanicBtn(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>‚å®Ô∏è</span> Keyboard Shortcuts
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Customize Shortcuts</h4>
          <p>Edit keyboard shortcuts for quick actions</p>
        </div>
        <div class="setting-control">
          <a href="/private/shortcuts.html" class="setting-btn">Edit Shortcuts</a>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üë§</span> Account
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Edit Profile</h4>
          <p>Update your profile information and avatar</p>
        </div>
        <div class="setting-control">
          <a href="/private/profile.html" class="setting-btn">Edit Profile</a>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Sign Out</h4>
          <p>Log out of your account</p>
        </div>
        <div class="setting-control">
          <button class="setting-btn danger" onclick="signOut()">Sign Out</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Mute Manager Modal -->
  <div id="muteManagerOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:1000;"></div>
  <div id="muteManagerModal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--card);border-radius:16px;padding:24px;width:90%;max-width:450px;z-index:1001;border:1px solid var(--accent);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <h3 id="muteManagerTitle" style="margin:0;color:var(--text);">Muted Items</h3>
      <button onclick="closeMuteManager()" style="background:none;border:none;font-size:24px;cursor:pointer;color:var(--text);">&times;</button>
    </div>
    <div id="mutedItemsList" style="max-height:300px;overflow-y:auto;margin-bottom:15px;">
      <p style="text-align:center;color:var(--text-light);">No muted items</p>
    </div>
    <p style="font-size:12px;color:var(--text-light);text-align:center;">To mute a server or user, right-click on them in the chat and select "Mute"</p>
  </div>
  
  <script src="/js/iframe-detect.js"></script>
  <script src="/js/themes.js"></script>
  <script src="/js/transitions.js"></script>
  <script src="/js/stealth-mode.js"></script>
  <script src="/js/quick-switcher.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      loadSettings();
    });
    
    function loadSettings() {
      const layoutMode = localStorage.getItem('layoutMode') || 'classic';
      document.getElementById('layoutClassic').classList.toggle('active', layoutMode === 'classic');
      document.getElementById('layoutOS').classList.toggle('active', layoutMode === 'os');
      
      const font = localStorage.getItem('globalFont') || 'Inter';
      document.getElementById('fontSelect').value = font;
      
      const fontSize = parseInt(localStorage.getItem('fontSize') || '100');
      document.getElementById('fontSizeValue').textContent = fontSize + '%';
      
      document.getElementById('reduceMotionToggle').checked = localStorage.getItem('reduceMotion') === 'true';
      document.getElementById('highContrastToggle').checked = localStorage.getItem('highContrast') === 'true';
      document.getElementById('notificationsToggle').checked = localStorage.getItem('notifications') !== 'false';
      document.getElementById('soundsToggle').checked = localStorage.getItem('sounds') !== 'false';
      
      // Load stealth settings
      document.getElementById('panicButtonToggle').checked = localStorage.getItem('panicButtonEnabled') !== 'false';
      document.getElementById('showPanicBtnToggle').checked = localStorage.getItem('showPanicButton') !== 'false';
      document.getElementById('panicTargetSelect').value = localStorage.getItem('panicTarget') || 'ClassLink Launchpad';
      document.getElementById('tabDisguiseSelect').value = localStorage.getItem('stealthDisguise') || 'None';
    }
    
    function setLayoutMode(mode) {
      localStorage.setItem('layoutMode', mode);
      document.getElementById('layoutClassic').classList.toggle('active', mode === 'classic');
      document.getElementById('layoutOS').classList.toggle('active', mode === 'os');
      
      if (typeof OSShell !== 'undefined') {
        OSShell.setLayoutMode(mode);
      } else {
        document.body.classList.remove('layout-classic', 'layout-os');
        document.body.classList.add(`layout-${mode}`);
      }
      
      if (mode === 'os') {
        window.location.href = '/private/dashboard.html';
      }
    }
    
    function setFont(font) {
      localStorage.setItem('globalFont', font);
      document.body.style.fontFamily = font + ', sans-serif';
      
      const link = document.createElement('link');
      link.href = `https://fonts.googleapis.com/css2?family=${font.replace(' ', '+')}:wght@300;400;500;600;700&display=swap`;
      link.rel = 'stylesheet';
      document.head.appendChild(link);
    }
    
    function adjustFontSize(delta) {
      let size = parseInt(localStorage.getItem('fontSize') || '100');
      size = Math.max(80, Math.min(150, size + delta * 10));
      localStorage.setItem('fontSize', size.toString());
      document.getElementById('fontSizeValue').textContent = size + '%';
      document.documentElement.style.fontSize = size + '%';
    }
    
    function toggleReduceMotion(enabled) {
      localStorage.setItem('reduceMotion', enabled.toString());
      if (enabled) {
        document.body.classList.add('reduce-motion');
      } else {
        document.body.classList.remove('reduce-motion');
      }
    }
    
    function toggleHighContrast(enabled) {
      localStorage.setItem('highContrast', enabled.toString());
      if (enabled) {
        document.body.classList.add('high-contrast');
      } else {
        document.body.classList.remove('high-contrast');
      }
    }
    
    function toggleNotifications(enabled) {
      localStorage.setItem('notifications', enabled.toString());
    }
    
    function toggleSounds(enabled) {
      localStorage.setItem('sounds', enabled.toString());
    }
    
    function signOut() {
      localStorage.removeItem('authToken');
      localStorage.removeItem('userToken');
      localStorage.removeItem('userId');
      localStorage.removeItem('username');
      window.location.href = '/';
    }
    
    // Stealth Mode Settings
    function togglePanicButton(enabled) {
      localStorage.setItem('panicButtonEnabled', enabled.toString());
    }
    
    function toggleShowPanicBtn(enabled) {
      localStorage.setItem('showPanicButton', enabled.toString());
      const panicBtn = document.getElementById('panicButton');
      if (panicBtn) {
        panicBtn.style.display = enabled ? 'flex' : 'none';
      }
    }
    
    function setPanicTarget(target) {
      localStorage.setItem('panicTarget', target);
      if (typeof StealthMode !== 'undefined') {
        StealthMode.loadSettings();
      }
    }
    
    function setTabDisguise(disguise) {
      localStorage.setItem('stealthDisguise', disguise);
      if (typeof StealthMode !== 'undefined') {
        if (disguise === 'None') {
          // Reset to original
          document.title = 'Settings - NebulaCore';
          StealthMode.setFavicon('/favicon.png');
        } else {
          StealthMode.loadSettings();
          StealthMode.applyTabCloak();
        }
      }
    }
    
    // Chat notification settings
    function toggleChatNotifications(enabled) {
      localStorage.setItem('chatNotifications', enabled.toString());
    }
    
    // Load chat notification setting
    document.getElementById('chatNotifToggle').checked = localStorage.getItem('chatNotifications') !== 'false';
    
    // Mute Manager
    let muteManagerType = 'servers';
    
    function openMuteManager(type) {
      muteManagerType = type;
      document.getElementById('muteManagerOverlay').style.display = 'block';
      document.getElementById('muteManagerModal').style.display = 'block';
      document.getElementById('muteManagerTitle').textContent = type === 'servers' ? 'Muted Servers' : 'Muted Users';
      loadMutedItems();
    }
    
    function closeMuteManager() {
      document.getElementById('muteManagerOverlay').style.display = 'none';
      document.getElementById('muteManagerModal').style.display = 'none';
    }
    
    async function loadMutedItems() {
      const list = document.getElementById('mutedItemsList');
      const key = muteManagerType === 'servers' ? 'mutedServers' : 'mutedUsers';
      const mutedIds = JSON.parse(localStorage.getItem(key) || '[]');
      
      if (mutedIds.length === 0) {
        list.innerHTML = '<p style="text-align:center;color:var(--text-light);">No muted ' + muteManagerType + '</p>';
        return;
      }
      
      // Fetch names for the IDs
      const token = localStorage.getItem('userToken') || localStorage.getItem('authToken');
      list.innerHTML = '';
      
      for (const id of mutedIds) {
        const item = document.createElement('div');
        item.style.cssText = 'display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg);border-radius:8px;margin-bottom:8px;';
        item.innerHTML = `
          <span style="color:var(--text);">${muteManagerType === 'servers' ? 'Server' : 'User'} #${id}</span>
          <button onclick="unmuteItem(${id})" style="padding:6px 12px;background:#ff4444;color:white;border:none;border-radius:6px;cursor:pointer;">Unmute</button>
        `;
        list.appendChild(item);
      }
    }
    
    function unmuteItem(id) {
      const key = muteManagerType === 'servers' ? 'mutedServers' : 'mutedUsers';
      let mutedIds = JSON.parse(localStorage.getItem(key) || '[]');
      mutedIds = mutedIds.filter(i => i !== id);
      localStorage.setItem(key, JSON.stringify(mutedIds));
      loadMutedItems();
    }
  </script>
  <script src="/js/os-shell.js"></script>
  <script src="/js/security.js"></script>
</body>
</html>
