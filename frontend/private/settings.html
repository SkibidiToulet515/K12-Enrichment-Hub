<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - NebulaCore</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="shortcut icon" type="image/png" href="/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/transitions.css">
  <link rel="stylesheet" href="/css/private-theme.css">
  <link rel="stylesheet" href="/css/private.css">
  <link rel="stylesheet" href="/css/os-shell.css">
  <link rel="stylesheet" href="/css/polish.css">
  <script src="/js/default-avatar.js"></script>
  <script src="/js/private-auth.js"></script>
  <style>
    .settings-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 30px;
    }
    
    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .settings-header h1 {
      font-size: 2rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .back-btn {
      padding: 10px 20px;
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s;
    }
    
    .back-btn:hover {
      background: var(--primary);
      color: var(--bg);
    }
    
    .settings-section {
      background: var(--card);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .settings-section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .settings-section-title span {
      font-size: 24px;
    }
    
    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .setting-item:last-child {
      border-bottom: none;
    }
    
    .setting-info h4 {
      font-size: 15px;
      font-weight: 500;
      color: var(--text);
      margin: 0 0 4px;
    }
    
    .setting-info p {
      font-size: 13px;
      color: var(--text-secondary);
      margin: 0;
    }
    
    .setting-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg);
      border: 2px solid var(--glass-border);
      border-radius: 26px;
      transition: 0.3s;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 2px;
      bottom: 2px;
      background: var(--text);
      border-radius: 50%;
      transition: 0.3s;
    }
    
    .toggle-switch input:checked + .toggle-slider {
      background: var(--primary);
      border-color: var(--primary);
    }
    
    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(24px);
      background: white;
    }
    
    .layout-preview-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 15px;
    }
    
    .layout-preview {
      border: 3px solid var(--glass-border);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s;
      background: var(--bg);
    }
    
    .layout-preview:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }
    
    .layout-preview.active {
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(var(--primary-rgb, 76, 201, 240), 0.3);
    }
    
    .layout-preview-image {
      width: 100%;
      height: 150px;
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    .layout-preview-classic {
      display: flex;
      flex-direction: column;
      height: 100%;
      padding: 10px;
    }
    
    .layout-preview-classic .preview-nav {
      height: 20px;
      background: var(--accent);
      border-radius: 4px;
      margin-bottom: 8px;
    }
    
    .layout-preview-classic .preview-content {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }
    
    .layout-preview-classic .preview-card {
      background: var(--card);
      border-radius: 4px;
    }
    
    .layout-preview-os {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .layout-preview-os .preview-desktop {
      flex: 1;
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }
    
    .layout-preview-os .preview-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .layout-preview-os .preview-icon-box {
      width: 24px;
      height: 24px;
      background: var(--card);
      border-radius: 6px;
    }
    
    .layout-preview-os .preview-icon-label {
      width: 20px;
      height: 4px;
      background: var(--text-secondary);
      border-radius: 2px;
    }
    
    .layout-preview-os .preview-window {
      position: absolute;
      top: 20px;
      left: 30px;
      right: 20px;
      bottom: 30px;
      background: var(--card);
      border-radius: 6px;
      border: 1px solid var(--glass-border);
      overflow: hidden;
    }
    
    .layout-preview-os .preview-window-header {
      height: 12px;
      background: var(--accent);
      display: flex;
      align-items: center;
      padding: 0 6px;
      gap: 3px;
    }
    
    .layout-preview-os .preview-window-btn {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }
    
    .layout-preview-os .preview-window-btn.red { background: #ff5f57; }
    .layout-preview-os .preview-window-btn.yellow { background: #ffbd2e; }
    .layout-preview-os .preview-window-btn.green { background: #28c940; }
    
    .layout-preview-os .preview-taskbar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 16px;
      background: rgba(20, 20, 30, 0.95);
      display: flex;
      align-items: center;
      padding: 0 6px;
      gap: 4px;
    }
    
    .layout-preview-os .preview-taskbar-btn {
      width: 12px;
      height: 12px;
      background: var(--primary);
      border-radius: 3px;
    }
    
    .layout-preview-os .preview-taskbar-app {
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    .layout-preview-label {
      padding: 12px;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
      background: var(--card);
    }
    
    .layout-preview.active .layout-preview-label {
      color: var(--primary);
    }
    
    select.setting-select {
      padding: 10px 15px;
      background: var(--bg);
      border: 2px solid var(--glass-border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
      min-width: 150px;
    }
    
    select.setting-select:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .setting-btn {
      padding: 10px 20px;
      background: var(--primary);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .setting-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(var(--primary-rgb, 76, 201, 240), 0.3);
    }
    
    .setting-btn.danger {
      background: #ff4444;
    }
    
    .setting-btn.danger:hover {
      box-shadow: 0 5px 15px rgba(255, 68, 68, 0.3);
    }
    
    .font-size-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .font-size-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: 2px solid var(--glass-border);
      background: var(--bg);
      color: var(--text);
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .font-size-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }
    
    .font-size-value {
      font-size: 14px;
      font-weight: 600;
      min-width: 40px;
      text-align: center;
    }
  </style>

</head>
<body>
  <script>document.body.classList.add('layout-' + (localStorage.getItem('layoutMode') || 'classic'));</script>
  <div class="settings-container">
    <div class="settings-header">
      <h1>‚öôÔ∏è Settings</h1>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üñ•Ô∏è</span> Layout Mode
      </div>
      <p style="color: var(--text-secondary); margin-bottom: 20px;">
        Choose between the classic web layout or the new OS-style desktop interface.
      </p>
      <div class="layout-preview-grid">
        <div class="layout-preview" id="layoutClassic" onclick="setLayoutMode('classic')">
          <div class="layout-preview-image">
            <div class="layout-preview-classic">
              <div class="preview-nav"></div>
              <div class="preview-content">
                <div class="preview-card"></div>
                <div class="preview-card"></div>
                <div class="preview-card"></div>
                <div class="preview-card"></div>
                <div class="preview-card"></div>
                <div class="preview-card"></div>
              </div>
            </div>
          </div>
          <div class="layout-preview-label">Classic Layout</div>
        </div>
        <div class="layout-preview" id="layoutOS" onclick="setLayoutMode('os')">
          <div class="layout-preview-image">
            <div class="layout-preview-os">
              <div class="preview-desktop">
                <div class="preview-icon"><div class="preview-icon-box"></div><div class="preview-icon-label"></div></div>
                <div class="preview-icon"><div class="preview-icon-box"></div><div class="preview-icon-label"></div></div>
                <div class="preview-icon"><div class="preview-icon-box"></div><div class="preview-icon-label"></div></div>
                <div class="preview-icon"><div class="preview-icon-box"></div><div class="preview-icon-label"></div></div>
              </div>
              <div class="preview-window">
                <div class="preview-window-header">
                  <div class="preview-window-btn red"></div>
                  <div class="preview-window-btn yellow"></div>
                  <div class="preview-window-btn green"></div>
                </div>
              </div>
              <div class="preview-taskbar">
                <div class="preview-taskbar-btn"></div>
                <div class="preview-taskbar-app"></div>
                <div class="preview-taskbar-app"></div>
                <div class="preview-taskbar-app"></div>
              </div>
            </div>
          </div>
          <div class="layout-preview-label">OS Layout</div>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üé®</span> Appearance
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Theme</h4>
          <p>Choose your visual theme</p>
        </div>
        <div class="setting-control">
          <a href="/themes" class="setting-btn">Open Theme Selector</a>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Custom Theme Creator</h4>
          <p>Create and share your own themes</p>
        </div>
        <div class="setting-control">
          <a href="/theme-creator" class="setting-btn">Open Theme Creator</a>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Custom Wallpaper</h4>
          <p>Upload a background image for your dashboard</p>
        </div>
        <div class="setting-control" style="flex-direction:column;align-items:flex-end;gap:8px;">
          <div style="display:flex;gap:8px;align-items:center;">
            <input type="file" id="wallpaperInput" accept="image/*" style="display:none;">
            <button class="setting-btn" onclick="document.getElementById('wallpaperInput').click()">Choose File</button>
            <button class="setting-btn" onclick="uploadWallpaper()">Upload</button>
            <button class="setting-btn" style="background:#ff4444;" onclick="removeWallpaper()">Remove</button>
          </div>
          <div id="wallpaperFileName" style="font-size:12px;color:var(--text-secondary);"></div>
          <div id="wallpaperPreview" style="width:120px;height:68px;border-radius:6px;overflow:hidden;border:1px solid var(--bg-secondary);display:none;">
            <img id="wallpaperPreviewImg" style="width:100%;height:100%;object-fit:cover;">
          </div>
          <div id="wallpaperStatus" style="font-size:12px;color:var(--accent);display:none;"></div>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Font Family</h4>
          <p>Change the global font</p>
        </div>
        <div class="setting-control">
          <select class="setting-select" id="fontSelect" onchange="setFont(this.value)">
            <option value="Inter">Inter (Default)</option>
            <option value="Roboto">Roboto</option>
            <option value="Open Sans">Open Sans</option>
            <option value="Poppins">Poppins</option>
            <option value="Montserrat">Montserrat</option>
            <option value="Source Code Pro">Source Code Pro</option>
            <option value="JetBrains Mono">JetBrains Mono</option>
          </select>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Custom Cursor</h4>
          <p>Choose a fun cursor style</p>
        </div>
        <div class="setting-control">
          <select class="setting-select" id="cursorSelect" onchange="setCursor(this.value)">
            <option value="default">Default</option>
            <option value="crosshair">Crosshair</option>
            <option value="pointer">Pointer</option>
            <option value="cell">Cell</option>
            <option value="text">Text</option>
            <option value="wait">Wait</option>
            <option value="help">Help</option>
            <option value="grab">Grab</option>
            <option value="neon">Neon Glow</option>
            <option value="retro">Retro Pixel</option>
            <option value="minimal">Minimal Dot</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üîä</span> Sound Effects
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Enable Sounds</h4>
          <p>Play sounds for notifications and actions</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="soundsEnabledToggle" onchange="toggleSounds(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Notification Sound</h4>
          <p>Sound for new messages and alerts</p>
        </div>
        <div class="setting-control" style="gap:8px;">
          <select class="setting-select" id="notifSoundSelect" onchange="setNotifSound(this.value)">
            <option value="chime">Chime</option>
            <option value="pop">Pop</option>
            <option value="ding">Ding</option>
            <option value="swoosh">Swoosh</option>
            <option value="bubble">Bubble</option>
            <option value="bell">Bell</option>
          </select>
          <button class="setting-btn" onclick="previewSound('notif')">Preview</button>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Click Sound</h4>
          <p>Sound for button clicks</p>
        </div>
        <div class="setting-control" style="gap:8px;">
          <select class="setting-select" id="clickSoundSelect" onchange="setClickSound(this.value)">
            <option value="none">None</option>
            <option value="click">Click</option>
            <option value="tap">Tap</option>
            <option value="soft">Soft</option>
          </select>
          <button class="setting-btn" onclick="previewSound('click')">Preview</button>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Volume</h4>
          <p>Adjust sound effect volume</p>
        </div>
        <div class="setting-control">
          <input type="range" id="soundVolume" min="0" max="100" value="50" style="width:120px;" onchange="setSoundVolume(this.value)">
          <span id="volumeValue" style="width:40px;text-align:right;">50%</span>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>‚ôø</span> Accessibility
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Font Size</h4>
          <p>Adjust the base font size</p>
        </div>
        <div class="setting-control">
          <div class="font-size-control">
            <button class="font-size-btn" onclick="adjustFontSize(-1)">‚àí</button>
            <span class="font-size-value" id="fontSizeValue">100%</span>
            <button class="font-size-btn" onclick="adjustFontSize(1)">+</button>
          </div>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Reduce Motion</h4>
          <p>Minimize animations and transitions</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="reduceMotionToggle" onchange="toggleReduceMotion(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>High Contrast</h4>
          <p>Increase color contrast for better visibility</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="highContrastToggle" onchange="toggleHighContrast(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>‚ú®</span> Visual Effects
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Particle Background</h4>
          <p>Animated floating particles in the background</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="particlesToggle" checked onchange="toggleParticles(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Particle Density</h4>
          <p>Number of particles on screen</p>
        </div>
        <div class="setting-control">
          <select class="setting-select" id="particleDensitySelect" onchange="setParticleDensity(this.value)">
            <option value="low">Low (20)</option>
            <option value="medium" selected>Medium (40)</option>
            <option value="high">High (60)</option>
          </select>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Glow Effects</h4>
          <p>Neon glow on buttons and elements</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="glowToggle" checked onchange="toggleGlowEffects(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üîî</span> Notifications
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Enable Notifications</h4>
          <p>Show notification popups</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="notificationsToggle" checked onchange="toggleNotifications(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Sound Effects</h4>
          <p>Play sounds for notifications and actions</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="soundsToggle" checked onchange="toggleSounds(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Chat Message Notifications</h4>
          <p>Show notifications for new chat messages</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="chatNotifToggle" checked onchange="toggleChatNotifications(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Muted Servers</h4>
          <p>Servers you won't receive notifications from</p>
        </div>
        <div class="setting-control">
          <button class="setting-btn" onclick="openMuteManager('servers')">Manage</button>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Muted Users</h4>
          <p>Users you won't receive notifications from</p>
        </div>
        <div class="setting-control">
          <button class="setting-btn" onclick="openMuteManager('users')">Manage</button>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üõ°Ô∏è</span> Stealth Mode & Cloaking
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Panic Button</h4>
          <p>Press ` (backtick) or ESC twice to activate</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="panicButtonToggle" checked onchange="togglePanicButton(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Panic Destination</h4>
          <p>Where to redirect when panic is triggered</p>
        </div>
        <div class="setting-control">
          <select class="setting-select" id="panicTargetSelect" onchange="setPanicTarget(this.value)">
            <option value="ClassLink Launchpad">ClassLink Launchpad</option>
            <option value="Staff Portal Login">Staff Portal Login</option>
          </select>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Tab Disguise</h4>
          <p>Change tab title and icon to look like another site</p>
        </div>
        <div class="setting-control">
          <select class="setting-select" id="tabDisguiseSelect" onchange="setTabDisguise(this.value)">
            <option value="None">None (NebulaCore)</option>
            <option value="Google Docs">Google Docs</option>
            <option value="Google Classroom">Google Classroom</option>
            <option value="Khan Academy">Khan Academy</option>
            <option value="Google Drive">Google Drive</option>
          </select>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Show Panic Button</h4>
          <p>Display the floating panic button on screen</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="showPanicBtnToggle" checked onchange="toggleShowPanicBtn(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Tab Cloaking</h4>
          <p>Change tab icon and title to "My Apps"</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" id="tabCloakToggle" onchange="toggleTabCloak(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Auto-Cloak Mode</h4>
          <p>Automatically open site in cloaked window</p>
        </div>
        <div class="setting-control">
          <select class="setting-select" id="autoCloakSelect" onchange="setAutoCloak(this.value)">
            <option value="none">Disabled</option>
            <option value="aboutblank">about:blank</option>
            <option value="blob">blob: URL</option>
          </select>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Open in Cloaked Window</h4>
          <p>Manually open site in hidden window now</p>
        </div>
        <div class="setting-control">
          <button class="setting-btn" onclick="openAboutBlank()">about:blank</button>
          <button class="setting-btn" onclick="openBlob()">blob: URL</button>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>‚å®Ô∏è</span> Keyboard Shortcuts
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Customize Shortcuts</h4>
          <p>Edit keyboard shortcuts for quick actions</p>
        </div>
        <div class="setting-control">
          <a href="/shortcuts" class="setting-btn">Edit Shortcuts</a>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <div class="settings-section-title">
        <span>üë§</span> Account
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Edit Profile</h4>
          <p>Update your profile information and avatar</p>
        </div>
        <div class="setting-control">
          <a href="/profile" class="setting-btn">Edit Profile</a>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>Sign Out</h4>
          <p>Log out of your account</p>
        </div>
        <div class="setting-control">
          <button class="setting-btn danger" onclick="signOut()">Sign Out</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Mute Manager Modal -->
  <div id="muteManagerOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:1000;"></div>
  <div id="muteManagerModal" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--card);border-radius:16px;padding:24px;width:90%;max-width:450px;z-index:1001;border:1px solid var(--accent);">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
      <h3 id="muteManagerTitle" style="margin:0;color:var(--text);">Muted Items</h3>
      <button onclick="closeMuteManager()" style="background:none;border:none;font-size:24px;cursor:pointer;color:var(--text);">&times;</button>
    </div>
    <div id="mutedItemsList" style="max-height:300px;overflow-y:auto;margin-bottom:15px;">
      <p style="text-align:center;color:var(--text-light);">No muted items</p>
    </div>
    <p style="font-size:12px;color:var(--text-light);text-align:center;">To mute a server or user, right-click on them in the chat and select "Mute"</p>
  </div>
  
  <script src="/js/iframe-detect.js"></script>
  <script src="/js/themes.js"></script>
  <script src="/js/transitions.js"></script>
  <script src="/js/stealth-mode.js"></script>
  <script src="/js/quick-switcher.js"></script>
  <script src="/js/cloak.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      loadSettings();
    });
    
    function loadSettings() {
      const layoutMode = localStorage.getItem('layoutMode') || 'classic';
      document.getElementById('layoutClassic').classList.toggle('active', layoutMode === 'classic');
      document.getElementById('layoutOS').classList.toggle('active', layoutMode === 'os');
      
      const font = localStorage.getItem('globalFont') || 'Inter';
      document.getElementById('fontSelect').value = font;
      
      const fontSize = parseInt(localStorage.getItem('fontSize') || '100');
      document.getElementById('fontSizeValue').textContent = fontSize + '%';
      
      document.getElementById('reduceMotionToggle').checked = localStorage.getItem('reduceMotion') === 'true';
      document.getElementById('highContrastToggle').checked = localStorage.getItem('highContrast') === 'true';
      document.getElementById('notificationsToggle').checked = localStorage.getItem('notifications') !== 'false';
      document.getElementById('soundsToggle').checked = localStorage.getItem('sounds') !== 'false';
      
      // Load stealth settings
      document.getElementById('panicButtonToggle').checked = localStorage.getItem('panicButtonEnabled') !== 'false';
      document.getElementById('showPanicBtnToggle').checked = localStorage.getItem('showPanicButton') !== 'false';
      document.getElementById('panicTargetSelect').value = localStorage.getItem('panicTarget') || 'ClassLink Launchpad';
      document.getElementById('tabDisguiseSelect').value = localStorage.getItem('stealthDisguise') || 'None';
      
      // Load cloaking settings
      const cloakSettings = JSON.parse(localStorage.getItem('cloakSettings') || '{}');
      document.getElementById('tabCloakToggle').checked = cloakSettings.tabCloak === true;
      document.getElementById('autoCloakSelect').value = cloakSettings.autoCloak || 'none';
    }
    
    function toggleTabCloak(enabled) {
      const settings = JSON.parse(localStorage.getItem('cloakSettings') || '{}');
      settings.tabCloak = enabled;
      localStorage.setItem('cloakSettings', JSON.stringify(settings));
      if (enabled && typeof CloakManager !== 'undefined') {
        CloakManager.applyTabCloak();
      } else {
        location.reload();
      }
    }
    
    function setAutoCloak(mode) {
      const settings = JSON.parse(localStorage.getItem('cloakSettings') || '{}');
      settings.autoCloak = mode;
      localStorage.setItem('cloakSettings', JSON.stringify(settings));
    }
    
    function openAboutBlank() {
      if (typeof CloakManager !== 'undefined') {
        CloakManager.openInAboutBlank();
      }
    }
    
    function openBlob() {
      if (typeof CloakManager !== 'undefined') {
        CloakManager.openInBlob();
      }
    }
    
    function setLayoutMode(mode) {
      localStorage.setItem('layoutMode', mode);
      document.getElementById('layoutClassic').classList.toggle('active', mode === 'classic');
      document.getElementById('layoutOS').classList.toggle('active', mode === 'os');
      
      if (typeof OSShell !== 'undefined') {
        OSShell.setLayoutMode(mode);
      } else {
        document.body.classList.remove('layout-classic', 'layout-os');
        document.body.classList.add(`layout-${mode}`);
      }
      
      if (mode === 'os') {
        window.location.href = '/dashboard';
      }
    }
    
    function setFont(font) {
      localStorage.setItem('globalFont', font);
      document.body.style.fontFamily = font + ', sans-serif';
      
      const link = document.createElement('link');
      link.href = `https://fonts.googleapis.com/css2?family=${font.replace(' ', '+')}:wght@300;400;500;600;700&display=swap`;
      link.rel = 'stylesheet';
      document.head.appendChild(link);
    }
    
    function adjustFontSize(delta) {
      let size = parseInt(localStorage.getItem('fontSize') || '100');
      size = Math.max(80, Math.min(150, size + delta * 10));
      localStorage.setItem('fontSize', size.toString());
      document.getElementById('fontSizeValue').textContent = size + '%';
      document.documentElement.style.fontSize = size + '%';
    }
    
    function toggleReduceMotion(enabled) {
      localStorage.setItem('reduceMotion', enabled.toString());
      if (enabled) {
        document.body.classList.add('reduce-motion');
      } else {
        document.body.classList.remove('reduce-motion');
      }
    }
    
    function toggleHighContrast(enabled) {
      localStorage.setItem('highContrast', enabled.toString());
      if (enabled) {
        document.body.classList.add('high-contrast');
      } else {
        document.body.classList.remove('high-contrast');
      }
    }
    
    function toggleNotifications(enabled) {
      localStorage.setItem('notifications', enabled.toString());
    }
    
    function toggleSounds(enabled) {
      localStorage.setItem('sounds', enabled.toString());
    }
    
    // Wallpaper functions
    document.getElementById('wallpaperInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        document.getElementById('wallpaperFileName').textContent = file.name;
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('wallpaperPreviewImg').src = e.target.result;
          document.getElementById('wallpaperPreview').style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });
    
    async function uploadWallpaper() {
      const fileInput = document.getElementById('wallpaperInput');
      const status = document.getElementById('wallpaperStatus');
      
      if (!fileInput.files.length) {
        status.textContent = 'Please select an image first';
        status.style.color = '#ff4444';
        status.style.display = 'block';
        return;
      }
      
      const token = localStorage.getItem('userToken') || localStorage.getItem('authToken');
      if (!token) {
        status.textContent = 'Please log in to upload wallpaper';
        status.style.color = '#ff4444';
        status.style.display = 'block';
        return;
      }
      
      const formData = new FormData();
      formData.append('wallpaper', fileInput.files[0]);
      
      try {
        status.textContent = 'Uploading...';
        status.style.color = 'var(--text-secondary)';
        status.style.display = 'block';
        
        const response = await fetch('/api/customization/wallpaper', {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${token}` },
          body: formData
        });
        
        const data = await response.json();
        if (response.ok) {
          localStorage.setItem('customWallpaper', data.wallpaper_url);
          status.textContent = 'Wallpaper saved! It will appear on your dashboard.';
          status.style.color = 'var(--accent)';
          fileInput.value = '';
        } else {
          status.textContent = data.error || 'Upload failed';
          status.style.color = '#ff4444';
        }
      } catch (err) {
        console.error('Wallpaper upload error:', err);
        status.textContent = 'Upload failed - please try again';
        status.style.color = '#ff4444';
      }
    }
    
    async function removeWallpaper() {
      const status = document.getElementById('wallpaperStatus');
      const token = localStorage.getItem('userToken') || localStorage.getItem('authToken');
      
      if (!token) {
        status.textContent = 'Please log in';
        status.style.color = '#ff4444';
        status.style.display = 'block';
        return;
      }
      
      try {
        const response = await fetch('/api/customization/wallpaper', {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (response.ok) {
          localStorage.removeItem('customWallpaper');
          document.getElementById('wallpaperPreview').style.display = 'none';
          document.getElementById('wallpaperFileName').textContent = '';
          status.textContent = 'Wallpaper removed';
          status.style.color = 'var(--text-secondary)';
          status.style.display = 'block';
        }
      } catch (err) {
        console.error('Wallpaper remove error:', err);
        status.textContent = 'Failed to remove wallpaper';
        status.style.color = '#ff4444';
        status.style.display = 'block';
      }
    }
    
    // Load current wallpaper preview on page load
    (function loadWallpaperPreview() {
      const savedWallpaper = localStorage.getItem('customWallpaper');
      if (savedWallpaper) {
        document.getElementById('wallpaperPreviewImg').src = savedWallpaper;
        document.getElementById('wallpaperPreview').style.display = 'block';
        document.getElementById('wallpaperFileName').textContent = 'Current wallpaper';
      }
    })();
    
    function signOut() {
      localStorage.removeItem('authToken');
      localStorage.removeItem('userToken');
      localStorage.removeItem('userId');
      localStorage.removeItem('username');
      window.location.href = '/';
    }
    
    // Stealth Mode Settings
    function togglePanicButton(enabled) {
      localStorage.setItem('panicButtonEnabled', enabled.toString());
    }
    
    function toggleShowPanicBtn(enabled) {
      localStorage.setItem('showPanicButton', enabled.toString());
      const panicBtn = document.getElementById('panicButton');
      if (panicBtn) {
        panicBtn.style.display = enabled ? 'flex' : 'none';
      }
    }
    
    function setPanicTarget(target) {
      localStorage.setItem('panicTarget', target);
      if (typeof StealthMode !== 'undefined') {
        StealthMode.loadSettings();
      }
    }
    
    function setTabDisguise(disguise) {
      localStorage.setItem('stealthDisguise', disguise);
      if (typeof StealthMode !== 'undefined') {
        if (disguise === 'None') {
          // Reset to original
          document.title = 'Settings - NebulaCore';
          StealthMode.setFavicon('/favicon.png');
        } else {
          StealthMode.loadSettings();
          StealthMode.applyTabCloak();
        }
      }
    }
    
    // Chat notification settings
    function toggleChatNotifications(enabled) {
      localStorage.setItem('chatNotifications', enabled.toString());
    }
    
    // Load chat notification setting
    document.getElementById('chatNotifToggle').checked = localStorage.getItem('chatNotifications') !== 'false';
    
    // Mute Manager
    let muteManagerType = 'servers';
    
    function openMuteManager(type) {
      muteManagerType = type;
      document.getElementById('muteManagerOverlay').style.display = 'block';
      document.getElementById('muteManagerModal').style.display = 'block';
      document.getElementById('muteManagerTitle').textContent = type === 'servers' ? 'Muted Servers' : 'Muted Users';
      loadMutedItems();
    }
    
    function closeMuteManager() {
      document.getElementById('muteManagerOverlay').style.display = 'none';
      document.getElementById('muteManagerModal').style.display = 'none';
    }
    
    async function loadMutedItems() {
      const list = document.getElementById('mutedItemsList');
      const key = muteManagerType === 'servers' ? 'mutedServers' : 'mutedUsers';
      const mutedIds = JSON.parse(localStorage.getItem(key) || '[]');
      
      if (mutedIds.length === 0) {
        list.innerHTML = '<p style="text-align:center;color:var(--text-light);">No muted ' + muteManagerType + '</p>';
        return;
      }
      
      // Fetch names for the IDs
      const token = localStorage.getItem('userToken') || localStorage.getItem('authToken');
      list.innerHTML = '';
      
      for (const id of mutedIds) {
        const item = document.createElement('div');
        item.style.cssText = 'display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg);border-radius:8px;margin-bottom:8px;';
        item.innerHTML = `
          <span style="color:var(--text);">${muteManagerType === 'servers' ? 'Server' : 'User'} #${id}</span>
          <button onclick="unmuteItem(${id})" style="padding:6px 12px;background:#ff4444;color:white;border:none;border-radius:6px;cursor:pointer;">Unmute</button>
        `;
        list.appendChild(item);
      }
    }
    
    function unmuteItem(id) {
      const key = muteManagerType === 'servers' ? 'mutedServers' : 'mutedUsers';
      let mutedIds = JSON.parse(localStorage.getItem(key) || '[]');
      mutedIds = mutedIds.filter(i => i !== id);
      localStorage.setItem(key, JSON.stringify(mutedIds));
      loadMutedItems();
    }
    
    // Custom Cursors
    const customCursors = {
      neon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><circle cx="12" cy="12" r="8" fill="none" stroke="%2300ffff" stroke-width="2"/><circle cx="12" cy="12" r="3" fill="%2300ffff"/></svg>',
      retro: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><rect width="4" height="4" fill="%23000"/><rect x="4" y="4" width="4" height="4" fill="%23000"/><rect x="8" y="8" width="4" height="4" fill="%23000"/><rect x="12" y="12" width="4" height="4" fill="%23000"/></svg>',
      minimal: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12"><circle cx="6" cy="6" r="5" fill="%23fff" stroke="%23000" stroke-width="1"/></svg>'
    };
    
    function setCursor(style) {
      localStorage.setItem('cursorStyle', style);
      applyCursor(style);
    }
    
    function applyCursor(style) {
      if (customCursors[style]) {
        document.body.style.cursor = `url("${customCursors[style]}") 12 12, auto`;
      } else if (style === 'default') {
        document.body.style.cursor = '';
      } else {
        document.body.style.cursor = style;
      }
    }
    
    // Load saved cursor
    (function loadCursor() {
      const saved = localStorage.getItem('cursorStyle') || 'default';
      document.getElementById('cursorSelect').value = saved;
      applyCursor(saved);
    })();
    
    // Sound Effects
    const soundEffects = {
      chime: [523.25, 659.25, 783.99],
      pop: [880],
      ding: [1046.5],
      swoosh: [200, 400, 600],
      bubble: [300, 450],
      bell: [440, 554.37, 659.25],
      click: [1000],
      tap: [800],
      soft: [400]
    };
    
    let audioContext = null;
    
    function getAudioContext() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      return audioContext;
    }
    
    function playTone(frequencies, duration = 0.1) {
      const ctx = getAudioContext();
      const volume = (parseInt(localStorage.getItem('soundVolume') || '50')) / 100;
      
      frequencies.forEach((freq, i) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.frequency.value = freq;
        osc.type = 'sine';
        gain.gain.value = volume * 0.3;
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
        osc.start(ctx.currentTime + (i * 0.05));
        osc.stop(ctx.currentTime + duration + (i * 0.05));
      });
    }
    
    function toggleSounds(enabled) {
      localStorage.setItem('soundsEnabled', enabled.toString());
    }
    
    function setNotifSound(sound) {
      localStorage.setItem('notifSound', sound);
    }
    
    function setClickSound(sound) {
      localStorage.setItem('clickSound', sound);
    }
    
    function setSoundVolume(value) {
      localStorage.setItem('soundVolume', value);
      document.getElementById('volumeValue').textContent = value + '%';
    }
    
    function previewSound(type) {
      const soundsEnabled = localStorage.getItem('soundsEnabled') !== 'false';
      if (!soundsEnabled) {
        alert('Enable sounds first to preview');
        return;
      }
      
      let soundName;
      if (type === 'notif') {
        soundName = document.getElementById('notifSoundSelect').value;
      } else {
        soundName = document.getElementById('clickSoundSelect').value;
      }
      
      if (soundName && soundName !== 'none' && soundEffects[soundName]) {
        playTone(soundEffects[soundName]);
      }
    }
    
    // Load sound settings
    (function loadSoundSettings() {
      const enabled = localStorage.getItem('soundsEnabled') !== 'false';
      const notif = localStorage.getItem('notifSound') || 'chime';
      const click = localStorage.getItem('clickSound') || 'none';
      const volume = localStorage.getItem('soundVolume') || '50';
      
      document.getElementById('soundsToggle').checked = enabled;
      document.getElementById('notifSoundSelect').value = notif;
      document.getElementById('clickSoundSelect').value = click;
      document.getElementById('soundVolume').value = volume;
      document.getElementById('volumeValue').textContent = volume + '%';
    })();
    
    // Visual Effects Settings
    function toggleParticles(enabled) {
      localStorage.setItem('particlesEnabled', enabled.toString());
      if (window.particleBackground) {
        if (enabled) {
          window.particleBackground.init();
        } else {
          window.particleBackground.destroy();
        }
      }
    }
    
    function setParticleDensity(density) {
      localStorage.setItem('particleDensity', density);
      const counts = { low: 20, medium: 40, high: 60 };
      if (window.particleBackground) {
        window.particleBackground.setParticleCount(counts[density] || 40);
      }
    }
    
    function toggleGlowEffects(enabled) {
      localStorage.setItem('glowEffectsEnabled', enabled.toString());
      if (enabled) {
        document.body.classList.remove('no-glow');
      } else {
        document.body.classList.add('no-glow');
      }
    }
    
    // Load visual effects settings
    (function loadVisualSettings() {
      const particlesEnabled = localStorage.getItem('particlesEnabled') !== 'false';
      const density = localStorage.getItem('particleDensity') || 'medium';
      const glowEnabled = localStorage.getItem('glowEffectsEnabled') !== 'false';
      
      document.getElementById('particlesToggle').checked = particlesEnabled;
      document.getElementById('particleDensitySelect').value = density;
      document.getElementById('glowToggle').checked = glowEnabled;
      
      if (!glowEnabled) {
        document.body.classList.add('no-glow');
      }
    })();
  </script>
  <script src="/js/customization.js"></script>
  <script src="/js/particles.js"></script>
  <script src="/js/global-notifications.js"></script>
  <script src="/js/os-shell.js"></script>
  <script src="/js/security.js"></script>
</body>
</html>
