<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NebulaCore Desktop</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', 'Inter', -apple-system, sans-serif;
      background: #000;
      color: #fff;
      min-height: 100vh;
      overflow: hidden;
      user-select: none;
    }
    
    .desktop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 48px;
      background-image: url('/images/aurora.jpg');
      background-size: cover;
      background-position: center;
    }
    
    .desktop-icons {
      position: absolute;
      top: 10px;
      left: 10px;
      display: grid;
      grid-template-columns: repeat(1, 80px);
      gap: 5px;
    }
    
    .desktop-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 6px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.1s;
    }
    
    .desktop-icon:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .desktop-icon.selected {
      background: rgba(255,255,255,0.15);
      outline: 1px solid rgba(255,255,255,0.3);
    }
    
    .desktop-icon-img {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      margin-bottom: 4px;
    }
    
    .desktop-icon-label {
      font-size: 11px;
      text-align: center;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
      line-height: 1.3;
      max-width: 70px;
      word-wrap: break-word;
    }
    
    /* Windows 11 Taskbar */
    .taskbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 48px;
      background: rgba(32, 32, 32, 0.85);
      backdrop-filter: blur(30px) saturate(125%);
      display: flex;
      align-items: center;
      justify-content: center;
      border-top: 1px solid rgba(255,255,255,0.08);
    }
    
    .taskbar-center {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .taskbar-btn {
      width: 44px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.1s;
      font-size: 22px;
      position: relative;
    }
    
    .taskbar-btn:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .taskbar-btn.active {
      background: rgba(255,255,255,0.15);
    }
    
    .taskbar-btn.active::after {
      content: '';
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 3px;
      background: #60cdff;
      border-radius: 2px;
    }
    
    .taskbar-btn.open::after {
      content: '';
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 3px;
      background: rgba(255,255,255,0.6);
      border-radius: 2px;
    }
    
    .taskbar-btn.open.focused::after {
      width: 20px;
      background: #60cdff;
    }
    
    .taskbar-apps {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .start-btn {
      background: transparent;
    }
    
    .start-btn:hover {
      background: rgba(255,255,255,0.1);
    }
    
    /* System Tray */
    .system-tray {
      position: fixed;
      bottom: 0;
      right: 0;
      height: 48px;
      display: flex;
      align-items: center;
      padding: 0 12px;
      gap: 4px;
    }
    
    .tray-icons {
      display: flex;
      align-items: center;
      gap: 2px;
      padding: 6px 8px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .tray-icons:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .tray-icon {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .clock-area {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      padding: 4px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .clock-area:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .clock-time {
      font-weight: 400;
    }
    
    .clock-date {
      font-size: 11px;
      opacity: 0.8;
    }
    
    /* Start Menu */
    .start-menu {
      position: fixed;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%) scale(0.95);
      width: 600px;
      background: rgba(32, 32, 32, 0.95);
      backdrop-filter: blur(30px);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      opacity: 0;
      pointer-events: none;
      transition: all 0.2s ease;
      overflow: hidden;
    }
    
    .start-menu.active {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) scale(1);
    }
    
    .start-search {
      padding: 32px 40px 20px;
    }
    
    .start-search input {
      width: 100%;
      padding: 10px 16px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
      outline: none;
    }
    
    .start-search input:focus {
      border-color: #60cdff;
    }
    
    .start-search input::placeholder {
      color: rgba(255,255,255,0.5);
    }
    
    .start-section {
      padding: 0 40px 20px;
    }
    
    .start-section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    
    .start-apps {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 4px;
    }
    
    .start-app {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.1s;
    }
    
    .start-app:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .start-app-icon {
      font-size: 28px;
      margin-bottom: 6px;
    }
    
    .start-app-name {
      font-size: 11px;
      text-align: center;
    }
    
    .start-user {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 40px;
      border-top: 1px solid rgba(255,255,255,0.08);
      background: rgba(0,0,0,0.2);
    }
    
    .start-user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .start-user-info:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .start-user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #0078d4, #00bcf2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      overflow: hidden;
    }
    
    .start-user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .start-user-name {
      font-size: 13px;
    }
    
    .start-power {
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 18px;
    }
    
    .start-power:hover {
      background: rgba(255,255,255,0.1);
    }
    
    /* App Windows */
    .app-window {
      position: fixed;
      top: 50px;
      left: 100px;
      width: 900px;
      height: calc(100vh - 150px);
      background: #202020;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      display: none;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    
    .app-window.active {
      display: flex;
    }
    
    .app-window.maximized {
      top: 0;
      left: 0;
      width: 100%;
      height: calc(100vh - 48px);
      border-radius: 0;
    }
    
    .window-titlebar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 32px;
      background: #1f1f1f;
      padding-left: 12px;
    }
    
    .window-title {
      font-size: 12px;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .window-title-icon {
      font-size: 14px;
    }
    
    .window-controls {
      display: flex;
      height: 100%;
    }
    
    .window-ctrl-btn {
      width: 46px;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 10px;
      transition: background 0.1s;
    }
    
    .window-ctrl-btn:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .window-ctrl-btn.close:hover {
      background: #c42b1c;
    }
    
    .window-content {
      flex: 1;
      overflow: auto;
      background: #1a1a1a;
    }
    
    .window-content iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>
  <div class="desktop" id="desktop">
    <div class="desktop-icons">
      <div class="desktop-icon" data-app="proxy">
        <div class="desktop-icon-img">&#127760;</div>
        <div class="desktop-icon-label">Browser</div>
      </div>
      <div class="desktop-icon" data-app="games">
        <div class="desktop-icon-img">&#128193;</div>
        <div class="desktop-icon-label">File Explorer</div>
      </div>
      <div class="desktop-icon" data-app="settings">
        <div class="desktop-icon-img">&#9881;</div>
        <div class="desktop-icon-label">Settings</div>
      </div>
      <div class="desktop-icon" data-app="chat">
        <div class="desktop-icon-img">&#128172;</div>
        <div class="desktop-icon-label">Chat</div>
      </div>
      <div class="desktop-icon" data-app="shop">
        <div class="desktop-icon-img">&#128722;</div>
        <div class="desktop-icon-label">Store</div>
      </div>
      <div class="desktop-icon" data-app="bugs">
        <div class="desktop-icon-img">&#128221;</div>
        <div class="desktop-icon-label">Feedback Hub</div>
      </div>
    </div>
  </div>
  
  <!-- Taskbar -->
  <div class="taskbar">
    <div class="taskbar-center">
      <div class="taskbar-btn start-btn" id="startBtn" onclick="toggleStartMenu()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <rect x="1" y="1" width="8" height="8" rx="1"/>
          <rect x="11" y="1" width="8" height="8" rx="1"/>
          <rect x="1" y="11" width="8" height="8" rx="1"/>
          <rect x="11" y="11" width="8" height="8" rx="1"/>
        </svg>
      </div>
      <div class="taskbar-apps" id="taskbarApps"></div>
    </div>
    
    <div class="system-tray">
      <div class="tray-icons">
        <span class="tray-icon">&#128266;</span>
        <span class="tray-icon">&#128246;</span>
        <span class="tray-icon">&#128267;</span>
      </div>
      <div class="clock-area" id="clockArea">
        <div class="clock-time" id="clockTime">12:00 PM</div>
        <div class="clock-date" id="clockDate">12/17/2025</div>
      </div>
    </div>
  </div>
  
  <!-- Start Menu -->
  <div class="start-menu" id="startMenu">
    <div class="start-search">
      <input type="text" placeholder="Type here to search" id="startSearch">
    </div>
    
    <div class="start-section">
      <div class="start-section-title">Pinned</div>
      <div class="start-apps">
        <div class="start-app" data-app="proxy">
          <div class="start-app-icon">&#127760;</div>
          <div class="start-app-name">Browser</div>
        </div>
        <div class="start-app" data-app="games">
          <div class="start-app-icon">&#128193;</div>
          <div class="start-app-name">Files</div>
        </div>
        <div class="start-app" data-app="chat">
          <div class="start-app-icon">&#128172;</div>
          <div class="start-app-name">Chat</div>
        </div>
        <div class="start-app" data-app="settings">
          <div class="start-app-icon">&#9881;</div>
          <div class="start-app-name">Settings</div>
        </div>
        <div class="start-app" data-app="videos">
          <div class="start-app-icon">&#127910;</div>
          <div class="start-app-name">Videos</div>
        </div>
        <div class="start-app" data-app="music">
          <div class="start-app-icon">&#127925;</div>
          <div class="start-app-name">Music</div>
        </div>
        <div class="start-app" data-app="apps">
          <div class="start-app-icon">&#128290;</div>
          <div class="start-app-name">Calculator</div>
        </div>
        <div class="start-app" data-app="shop">
          <div class="start-app-icon">&#128722;</div>
          <div class="start-app-name">Store</div>
        </div>
        <div class="start-app" data-app="forums">
          <div class="start-app-icon">&#128221;</div>
          <div class="start-app-name">Notepad</div>
        </div>
        <div class="start-app" data-app="bugs">
          <div class="start-app-icon">&#128172;</div>
          <div class="start-app-name">Feedback</div>
        </div>
        <div class="start-app" data-app="admin">
          <div class="start-app-icon">&#128187;</div>
          <div class="start-app-name">Task Manager</div>
        </div>
        <div class="start-app" data-app="themes">
          <div class="start-app-icon">&#127912;</div>
          <div class="start-app-name">Themes</div>
        </div>
      </div>
    </div>
    
    <div class="start-user">
      <div class="start-user-info" data-app="profile">
        <div class="start-user-avatar" id="userAvatar">&#128100;</div>
        <div class="start-user-name" id="userName">User</div>
      </div>
      <div class="start-power" onclick="logout()">&#9211;</div>
    </div>
  </div>
  
  <!-- App Window -->
  <div class="app-window" id="appWindow">
    <div class="window-titlebar">
      <div class="window-title">
        <span class="window-title-icon" id="windowIcon">&#128193;</span>
        <span id="windowTitle">App</span>
      </div>
      <div class="window-controls">
        <div class="window-ctrl-btn minimize" onclick="minimizeWindow()">&#8211;</div>
        <div class="window-ctrl-btn maximize" onclick="toggleMaximize()">&#9633;</div>
        <div class="window-ctrl-btn close" onclick="closeWindow()">&#10005;</div>
      </div>
    </div>
    <div class="window-content">
      <iframe id="appFrame" src=""></iframe>
    </div>
  </div>

  <script>
    let startMenuOpen = false;
    let openApps = [];
    let currentApp = null;
    
    const appInfo = {
      dashboard: { title: 'Dashboard', icon: '&#127968;' },
      chat: { title: 'Chat', icon: '&#128172;' },
      games: { title: 'File Explorer', icon: '&#128193;' },
      proxy: { title: 'Browser', icon: '&#127760;' },
      settings: { title: 'Settings', icon: '&#9881;' },
      videos: { title: 'Videos', icon: '&#127910;' },
      music: { title: 'Music', icon: '&#127925;' },
      apps: { title: 'Calculator', icon: '&#128290;' },
      forums: { title: 'Notepad', icon: '&#128221;' },
      shop: { title: 'Microsoft Store', icon: '&#128722;' },
      admin: { title: 'Task Manager', icon: '&#128187;' },
      bugs: { title: 'Feedback Hub', icon: '&#128172;' },
      profile: { title: 'Your Profile', icon: '&#128100;' },
      themes: { title: 'Personalization', icon: '&#127912;' },
      leaderboard: { title: 'Leaderboard', icon: '&#127942;' }
    };
    
    function updateClock() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const hour12 = hours % 12 || 12;
      
      document.getElementById('clockTime').textContent = `${hour12}:${minutes} ${ampm}`;
      document.getElementById('clockDate').textContent = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()}`;
    }
    
    function toggleStartMenu() {
      startMenuOpen = !startMenuOpen;
      document.getElementById('startMenu').classList.toggle('active', startMenuOpen);
      document.getElementById('startBtn').classList.toggle('active', startMenuOpen);
    }
    
    function updateTaskbar() {
      const container = document.getElementById('taskbarApps');
      container.innerHTML = '';
      
      openApps.forEach(appName => {
        const app = appInfo[appName] || { icon: '&#128193;' };
        const btn = document.createElement('div');
        btn.className = 'taskbar-btn open';
        btn.setAttribute('data-taskbar-app', appName);
        btn.innerHTML = app.icon;
        
        if (appName === currentApp && document.getElementById('appWindow').classList.contains('active')) {
          btn.classList.add('focused');
        }
        
        btn.onclick = () => {
          const win = document.getElementById('appWindow');
          if (appName === currentApp && win.classList.contains('active')) {
            minimizeWindow();
          } else {
            openApp(appName);
          }
        };
        
        container.appendChild(btn);
      });
    }
    
    function openApp(appName) {
      const win = document.getElementById('appWindow');
      const frame = document.getElementById('appFrame');
      const title = document.getElementById('windowTitle');
      const icon = document.getElementById('windowIcon');
      
      const app = appInfo[appName] || { title: appName, icon: '&#128193;' };
      title.textContent = app.title;
      icon.innerHTML = app.icon;
      frame.src = `/pages/${appName}`;
      win.classList.add('active');
      
      if (!openApps.includes(appName)) {
        openApps.push(appName);
      }
      currentApp = appName;
      
      updateTaskbar();
      if (startMenuOpen) toggleStartMenu();
    }
    
    function closeWindow() {
      document.getElementById('appWindow').classList.remove('active');
      document.getElementById('appWindow').classList.remove('maximized');
      document.getElementById('appFrame').src = '';
      
      if (currentApp) {
        openApps = openApps.filter(a => a !== currentApp);
        currentApp = null;
      }
      updateTaskbar();
    }
    
    function minimizeWindow() {
      document.getElementById('appWindow').classList.remove('active');
      updateTaskbar();
    }
    
    function toggleMaximize() {
      document.getElementById('appWindow').classList.toggle('maximized');
    }
    
    function logout() {
      fetch('/api/auth/logout', { method: 'POST' });
      localStorage.clear();
      window.location.href = '/lock';
    }
    
    document.querySelectorAll('[data-app]').forEach(el => {
      el.addEventListener('click', () => openApp(el.dataset.app));
      el.addEventListener('dblclick', () => openApp(el.dataset.app));
    });
    
    document.getElementById('startSearch').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const query = e.target.value.toLowerCase().trim();
        const apps = ['dashboard', 'chat', 'games', 'proxy', 'settings', 'videos', 'music', 'apps', 'forums', 'shop', 'admin', 'bugs', 'themes', 'profile'];
        const match = apps.find(a => a.includes(query));
        if (match) {
          openApp(match);
          e.target.value = '';
        }
      }
    });
    
    document.addEventListener('click', (e) => {
      if (startMenuOpen && !e.target.closest('.start-menu') && !e.target.closest('#startBtn')) {
        toggleStartMenu();
      }
    });
    
    const savedUser = localStorage.getItem('username');
    const savedPic = localStorage.getItem('profilePicture');
    if (savedUser) {
      document.getElementById('userName').textContent = savedUser;
    }
    if (savedPic) {
      document.getElementById('userAvatar').innerHTML = `<img src="${savedPic}" alt="">`;
    }
    
    updateClock();
    setInterval(updateClock, 1000);
    
    const token = localStorage.getItem('userToken');
    if (!token) {
      window.location.href = '/lock';
    }
  </script>
  <script src="/js/security.js"></script>
</body>
</html>
